<html>

<div width = "400" height = "60">
    <h1>My Snake Game</h1>
</div>
<canvas id="gameBanner" width="400" height="50"></canvas>
<canvas id="gameCanvas" width="400" height="400"></canvas>

<script>
    //banner area
    let banner;
    let bannerContext;
    let eatenApples = 0;

    //game area
    const WIDTH = 400;
    const HEIGHT = 400;

    let canvas;
    let canvasContext;

    //snake params
    let snakeContext;
    let snakeLength = 10;
    const SNAKE_HEIGHT = 10;
    const INCREMENT = 5;
    let snakeArray = [
        { x: 60, y: 60 },
        { x: 40, y: 60 }
    ];
//let snakeX = Math.random() * WIDTH - snakeWidth;//x and y coordinates are from top left corner of snake.
//let snakeY = Math.random() * HEIGHT - SNAKE_HEIGHT;//must makesure snake starts fully on canvas
    let xIncrement = 5;
    let yIncrement = 0;

    //apple params
    let appleContext;
    const APPLE_RADIUS = SNAKE_HEIGHT/2;//so the circumference is same as snake 
    let appleX; //x and y coordinates are from center of circle
    let appleY;//this way the circle is fully in the canvas

    window.onload = () => {
        //banner area
        banner = document.getElementById('gameBanner');
        bannerContext = banner.getContext('2d');
        
        //game area
        canvas = document.getElementById('gameCanvas');
        snakeContext = canvas.getContext('2d');
        appleContext = canvas.getContext('2d');
        canvasContext = canvas.getContext('2d');
        appleReset();

        let framePerSecond = 30;
        let oneSecond = 1000;

        drawBanner();
        
        setInterval(() => {            
            moveEverything();
            drawEverything();
        }, oneSecond / framePerSecond);

        //arrows listener
        document.addEventListener('keydown', arrowPressed);
    };

    //reset apple position
    appleReset = () => {    
        appleX = Math.random() * (WIDTH - APPLE_RADIUS * 2) + APPLE_RADIUS;
        appleY = Math.random() * (HEIGHT - APPLE_RADIUS * 2) + APPLE_RADIUS;
    }

    //arrow listener function
    arrowPressed = (event) =>{
        var code = event.which;
        switch (code) {
            //right arrow
            case 39:
                if(yIncrement !== 0){//if was already going right or left, don't change. 
                    xIncrement = INCREMENT;
                    yIncrement = 0;
                }
                break;
            //left arrow
            case 37:
                if(yIncrement !== 0){//if was already going right or left, don't change.
                    xIncrement = -INCREMENT;
                    yIncrement = 0;
                }
                break;
            //up arrow
            case 38:    
                if(xIncrement !== 0){//if was already going up or down, don't change.
                    xIncrement = 0;
                    yIncrement = -INCREMENT;
                }
                break;
            //down arrow
            case 40:
                if(xIncrement !== 0){//if was already going up or down, don't change.
                    xIncrement = 0;
                    yIncrement = INCREMENT;     
                }           
                break;
        }
    };

    //make snake move
    moveEverything = () => {      
        nextStep = {
            x:snakeArray[0].x + xIncrement,
            y:snakeArray[0].y + yIncrement
        };

        snakeArray.forEach(item => {
            if(item.x === nextStep.x && item.y === nextStep.y){
                console.log('game over');
                
            }
        })
      
        //add head 
        snakeArray.unshift(nextStep);
        //remove tail
        snakeArray.pop();

        //keeping snake in canvas
        if(snakeArray[0].x > WIDTH)
        {
            snakeArray[0].x = 0;
        }
        if(snakeArray[0].x < 0){
            snakeArray[0].x  = WIDTH;
        }
        if(snakeArray[0].y > HEIGHT){
            snakeArray[0].y = 0;
        }
        if(snakeArray[0].y < 0){
            snakeArray[0].y = HEIGHT;
        }

        //collission with apple
        if((snakeArray[0].y > (appleY - APPLE_RADIUS) && snakeArray[0].y < appleY + APPLE_RADIUS) 
        && (snakeArray[0].x > (appleX - APPLE_RADIUS) && snakeArray[0].x < appleX + APPLE_RADIUS)  ) 
        {
            //update score
            eatenApples++;           
            drawBanner();
            //place new apple
            appleReset();
            //add link to snake
            newLink = {
                x:snakeArray[snakeArray.length-1].x - xIncrement,
                y:snakeArray[snakeArray.length-1].y - yIncrement
            };            
           
            snakeArray.push(newLink);           
        }
    }

    drawBanner = () =>{      
        colorRect(bannerContext, 0, 0, banner.width, banner.height, 'white');
        bannerContext.font = "30px Arial";
        bannerContext.fillStyle = 'black';
        bannerContext.fillText("Apples Eaten: " + eatenApples, 50, 30);
    }
    drawEverything = () => {
        //canvas
        colorRect(canvasContext, 0, 0, canvas.width, canvas.height, 'black');
        //snake
        snakeArray.forEach((coordinate) => 
        colorRect(snakeContext, coordinate.x, coordinate.y, snakeLength, SNAKE_HEIGHT, 'green'))
        //apple     
        colorCircle(appleContext, appleX, appleY, APPLE_RADIUS, 'red');
    };

    //create rectangle
    colorRect = (element, distanceX, distanceY, shapeHeight, shapeWidth, color) => {
        element.fillStyle = color;
        element.fillRect(distanceX, distanceY, shapeHeight, shapeWidth);
    };

    //create circle
    colorCircle = (element, distanceX, distanceY, radius, color) => {
        element.fillStyle = color;
        element.beginPath();
        element.arc(distanceX, distanceY, radius, 0, Math.PI * 2, true);
        element.fill();
    }
</script>
</html>