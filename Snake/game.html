<html>

<div width = "800" height = "10">
    <h1>My Snake Game</h1>
</div>
<canvas id="gameBanner" width="800" height="100"></canvas>
<canvas id="gameCanvas" width="400" height="400"></canvas>

<script>
    const DEBUG = false;
    //banner area
    let banner;
    let bannerContext;
    let eatenApples = 0;

    //game area
    const WIDTH = 400;
    const HEIGHT = 400;

    let canvas;
    let canvasContext;

    //snake params
    let snakeContext;
    let snakeLength = 10;
    const SNAKE_HEIGHT = 10;
    const INCREMENT = 10;
    let snakeArray = [
        { x: 60, y: 60 },
        { x: 40, y: 60 }
    ];

    let xIncrement = INCREMENT;
    let yIncrement = 0;

    //apple params
    let appleContext;
    const APPLE_RADIUS = SNAKE_HEIGHT/2;//so the circumference is same as snake 
    let appleX; //x and y coordinates are from center of circle
    let appleY;//this way the circle is fully in the canvas

    //game control
    let pause = true;
    let start = true;
    let gameOver = false;
    window.onload = () => {
        //banner area
        banner = document.getElementById('gameBanner');
        bannerContext = banner.getContext('2d');
        
        //game area
        canvas = document.getElementById('gameCanvas');
        snakeContext = canvas.getContext('2d');
        appleContext = canvas.getContext('2d');
        canvasContext = canvas.getContext('2d');
        appleReset();

        if(DEBUG){
            appleX = 100;
            appleY = 60 ;
        }

        let framePerSecond = 10 ;
        let oneSecond = 1000;

        
        drawEverything();
        setInterval(() => {     
            if(pause) {
                if(start){
                    drawBannerStart();
                }
                else{
                    drawBannerPause();
                }
            }
            else{
                drawBanner();
                moveEverything();
                drawEverything();
            }
        }, oneSecond / framePerSecond);

        //arrows listener
        document.addEventListener('keydown', arrowPressed);
    };

    //reset apple position
    appleReset = () => {          
        let x = Math.random() * (WIDTH - APPLE_RADIUS * 2) + APPLE_RADIUS;
         appleX=  Math.round(x / 10) * 10;
         let y =Math.random() * (HEIGHT - APPLE_RADIUS * 2) + APPLE_RADIUS;
        appleY =  Math.round(y / 10) * 10;

        if(DEBUG){
            console.log(appleX + " " + appleY)
        }
        snakeArray.forEach(item => {
            if(item.x === appleX && item.y === appleY){
                appleReset();
            }
        })
    }

    //arrow listener function
    arrowPressed = (event) =>{
        var code = event.which;
        switch (code) {
            //space
            case 32:
                pause = !pause;
                start = false;
            //right arrow
            case 39:
                if(yIncrement !== 0){//if was already going right or left, don't change. 
                    xIncrement = INCREMENT;
                    yIncrement = 0;
                }
                break;
            //left arrow
            case 37:
                if(yIncrement !== 0){//if was already going right or left, don't change.
                    xIncrement = -INCREMENT;
                    yIncrement = 0;
                }
                break;
            //up arrow
            case 38:    
                if(xIncrement !== 0){//if was already going up or down, don't change.
                    xIncrement = 0;
                    yIncrement = -INCREMENT;
                }
                break;
            //down arrow
            case 40:
                if(xIncrement !== 0){//if was already going up or down, don't change.
                    xIncrement = 0;
                    yIncrement = INCREMENT;     
                }           
                break;
        }
    };

    //make snake move
    moveEverything = () => {      
        nextStep = {
            x:snakeArray[0].x + xIncrement,
            y:snakeArray[0].y + yIncrement
        };

        //if snake touches it self
        snakeArray.forEach(item => {
            if(item.x === nextStep.x && item.y === nextStep.y){
                console.log('game over');   
                if(!DEBUG)
                    gameOver();        
            }
        })

        //if snake hits boarder
        if(nextStep.x > WIDTH || nextStep.x < 0 || nextStep.y > HEIGHT || nextStep.y < 0)
        {
            console.log('game over');
            if(!DEBUG){
                gameOver();
            }
        }
        
        //creating movement 
        snakeArray.unshift(nextStep);
        snakeArray.pop();

        //snake touches apple
        if((nextStep.y === appleY) && (nextStep.x === appleX) )
        {           
            //update score
            eatenApples++;   
            //place new apple
            appleReset();
            //add link to snake
            newLink = {
                x:snakeArray[snakeArray.length-1].x - xIncrement,
                y:snakeArray[snakeArray.length-1].y - yIncrement
            };            
           
            snakeArray.push(newLink);           
        }
    }

    gameOver = () =>{
        pause = true;   
        start = true;
        bannerContext.font = "20px Arial";
        bannerContext.fillStyle = 'black';
        bannerContext.fillText("Game Over! ", 50, 60);
    }

    drawBanner = () =>{      
        colorRect(bannerContext, 0, 0, banner.width, banner.height, 'white');
        bannerContext.font = "20px Arial";
        bannerContext.fillStyle = 'black';
        bannerContext.fillText("Press Spacebar to pause", 50, 25);
        bannerContext.fillText("Apples Eaten: " + eatenApples, 50, 90);
    }
    drawBannerPause = () =>{ 
        colorRect(bannerContext, 0, 0, banner.width, banner.height, 'white');
        bannerContext.font = "20px Arial";
        bannerContext.fillStyle = 'black';
        bannerContext.fillText("Press Spacebar to continue", 50, 25);
        bannerContext.fillText("Apples Eaten: " + eatenApples, 50, 90);
    }
    drawBannerStart = () =>{ 
        colorRect(bannerContext, 0, 0, banner.width, banner.height, 'white');
        bannerContext.font = "20px Arial";
        bannerContext.fillStyle = 'black';
        bannerContext.fillText("Press Spacebar to start", 50, 25);
        bannerContext.fillText("Apples Eaten: " + eatenApples, 50, 90);
    }

    drawEverything = () => {
        //canvas
        colorRect(canvasContext, 0, 0, canvas.width, canvas.height, 'black');
        //snake
        snakeArray.forEach((coordinate) => 
        colorRect(snakeContext, coordinate.x, coordinate.y, snakeLength, SNAKE_HEIGHT, 'green'))
        //apple     
        colorCircle(appleContext, appleX, appleY, APPLE_RADIUS, 'red');
    };

    //create rectangle
    colorRect = (element, distanceX, distanceY, shapeHeight, shapeWidth, color) => {
        element.fillStyle = color;
        element.fillRect(distanceX, distanceY, shapeHeight, shapeWidth);
    };

    //create circle
    colorCircle = (element, distanceX, distanceY, radius, color) => {
        element.fillStyle = color;
        element.beginPath();
        element.arc(distanceX, distanceY, radius, 0, Math.PI * 2, true);
        element.fill();
    }
</script>
</html>