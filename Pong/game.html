<html>

<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
    let canvas;
    let canvasContext;

    let ballRadius = 10;

    //ball params
    let ballX = 400;
    let ballSpeedX = 5;

    let ballY = 300;
    let ballSpeedY = 5;

    //paddle1 params
    let paddle1Y = 250;
    let paddle1score = 0;

    //paddle params
    let paddle2Y = 250;
    let paddle2score = 0;
    const PADDLE_HEIGHT = 100;
    const PADDLE_WIDTH = 10;

    const WINNING_SCORE = 3;

    let display = true;

    window.onload = () => {
        canvas = document.getElementById('gameCanvas');
        canvasContext = canvas.getContext('2d');

        let framePerSecond = 30;
        let oneSecond = 1000;

        //mouse movement listener
        canvas.addEventListener('mousemove', mouseMoved);

        document.addEventListener('keydown', keyPressed);

        setInterval(() => {
            if (display) {               
                drawEverything();
                changeXY();
            }
        }, oneSecond / framePerSecond);
    };

    //mouse location
    calculateMousePosition = (event) => {
        let rect = canvas.getBoundingClientRect();
        let root = document.documentElement;
        let mouseX = event.clientX - rect.left - root.scrollLeft;
        let mouseY = event.clientY - rect.top - root.scrollTop;

        return {
            x: mouseX,
            y: mouseY
        };
    };

    //mouse listener function
    mouseMoved = (event) => {
        let mousePos = calculateMousePosition(event);
        if (mousePos.x > canvas.width / 2)
            paddle2Y = mousePos.y;
        else {
            paddle1Y = mousePos.y;
        }

        //if paddle goes outside y axis
        if (paddle1Y > canvas.height - PADDLE_HEIGHT) {
            paddle1Y = canvas.height - PADDLE_HEIGHT;
        }

        if (paddle2Y > canvas.height - PADDLE_HEIGHT) {
            paddle2Y = canvas.height - PADDLE_HEIGHT;
        }
    };

    //
    keyPressed = () => display = true;

    //reset ball position and check for winner
    ballReset = () => {
        //do we have a winner?
        if (paddle2score >= WINNING_SCORE || paddle1score >= WINNING_SCORE) {
            display = false;
            canvasContext.fillStyle = "white";
            canvasContext.fillText('we have a winner!! press any key to contine', canvas.width / 2, 50);
            canvasContext.fillText(paddle1score + ' : ' + paddle2score, canvas.width / 2, 100);
            paddle2score = paddle1score = 0;
        }

        ballSpeedX = -ballSpeedX;
        ballSpeedY = 5;

        ballX = canvas.width / 2;
        ballY = canvas.height / 2;
    };

    //make ball move
    changeXY = () => {
        ballX += ballSpeedX;
        ballY += ballSpeedY;

        //x axis movement

        //collision on right side
        if (ballX > canvas.width - ballRadius) {
            if (ballY > paddle2Y && ballY < paddle2Y + PADDLE_HEIGHT) {
                ballSpeedX *= -1;

                //give ball an emph based on location of paddle hit
                let deltaY = (ballY - (paddle2Y + PADDLE_HEIGHT / 2)) * 0.35;
                let deltaX = deltaY;
                ballSpeedY = deltaY;

            }
            else {
                paddle1score++;
                ballReset();
            }
            console.log(ballSpeedY);
        }

        //collision on left side
        if (ballX < ballRadius) {
            if (ballY > paddle1Y && ballY < paddle1Y + PADDLE_HEIGHT) {
                ballSpeedX *= -1;

                //give ball an emph based on location of paddle hit
                let deltaY = (ballY - (paddle1Y + PADDLE_HEIGHT / 2)) * 0.35;
                let deltaX = deltaY;
                ballSpeedY = deltaY;
            }
            else {
                paddle2score++;
                ballReset();
            }
            console.log(ballSpeedY);
        }

        //y axis movement
        if (ballY > canvas.height - ballRadius || ballY < ballRadius) {
            ballSpeedY *= -1;
        }
    };

    drawEverything = () => {
        //canvas       
        colorRect(0, 0, canvas.width, canvas.height, 'black');

        //left player paddle 
        colorRect(0, paddle1Y, PADDLE_WIDTH, PADDLE_HEIGHT, 'white');

        //right player paddle 
        colorRect(canvas.width - PADDLE_WIDTH, paddle2Y, PADDLE_WIDTH, PADDLE_HEIGHT, 'white');

        //ball
        colorCircle(ballX, ballY, ballRadius, 'white');

        //score
        canvasContext.fillText(paddle1score + ' : ' + paddle2score, canvas.width / 2, 100);
    };

    //create rectangle
    colorRect = (distanceX, distanceY, shapeHeight, shapeWidth, color) => {
        canvasContext.fillStyle = color;
        canvasContext.fillRect(distanceX, distanceY, shapeHeight, shapeWidth);
    };

    //create circle
    colorCircle = (distanceX, distanceY, radius, color) => {
        canvasContext.fillStyle = color;
        canvasContext.beginPath();
        canvasContext.arc(distanceX, distanceY, radius, 0, Math.PI * 2, true);
        canvasContext.fill();
    }
</script>

</html>